#!/bin/bash

echo "Enum Script For DNS"

# Args 
# Target web app
# List vs individual
domain=$1


# Target port
ports="-ports $2"
# Setup files / dirs

#if [ ! -d "$domain" ]; then
#	mkdir $domain
#fi

#cd $domain

touch subdomains1.txt urls1.txt params1.txt
# Passive enum commands
## subdomain
### Amass
echo "Amass"
amassConfig=~/.config/amass/config.ini
amass enum -passive -df $domain -log amass.log -config $amassConfig >> subdomains1.txt
### assetfinder
#### Can add API keys detailed here:https://github.com/tomnomnom/assetfinder
echo "assetfinder"
cat $domain | assetfinder --subs-only >> subdomains1.txt

## Urls
### gau
echo "gau"
cat $domain | gau --subs --o url1.txt

### waybackurls
echo "waybackurls"
cat $domain | waybackurls >> urls1.txt

# Active enum 
#brute force
# knock


## Check for subdomain hijack
#go get github.com/haccer/subjack
#~/go/bin/subjack -w $url/recon/final.txt -t 100 -timeout 30 -ssl -c ~/go/src/github.com/haccer/subjack/fingerprints.json -v 3 -o $url/recon/potential_takeover/PT.txt

# Last checks 

##Uniq results
echo "sorting"
uniq urls1.txt >> urls.txt && rm urls1.txt
uniq subdomains1.txt >> subdomains.txt && rm subdomains1.txt
## Pull parameters from results 

cat urls.txt | grep '?*=' | cut -d '=' -f 1 | sort -u >> params.txt

## Pull domains from certs
cat subdomains.txt | cero -c 1000 >> subdomains.txt


## Check if domains are active
###https://github.com/tomnomnom/httprobe
#### Option to proxy traffic through burp

## Screenshot each domain
echo "getting screenshots"
wget -q https://github.com/michenriksen/aquatone/releases/download/v1.7.0/aquatone_linux_amd64_1.7.0.zip -O aquatone.zip && mkdir tools && unzip aquatone.zip -d tools/

#defaut ports "80,443,8000,8080,8443"
cp subdomains.txt http.txt
cp subdomains.txt https.txt
sed -i -e 's/^/http:\/\//' http.txt
sed -i -e 's/^/https:\/\//' https.txt
cat http.txt https.txt > screenshots.txt
cat urls.txt >> screenshots.txt
cat screenshots.txt | tools/aquatone $ports -silent -out ./

# Output
firefox ./results.html ./aquatone_report.html
