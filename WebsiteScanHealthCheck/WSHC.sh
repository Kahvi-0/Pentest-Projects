#!/bin/bash

usage='WSHC.sh <URL> <Expected Status code>\n status code format: 200|301'

red=`tput setaf 1`
bg=`tput setab 7`
reset=`tput sgr 0`
count429=0
expectedstatus=$2
count502=0
time='  HTTP Status:	%{http_code}\n 
	time_namelookup:  %{time_namelookup}s\n                                              1 âš™
        time_connect:  %{time_connect}s\n   
     time_appconnect:  %{time_appconnect}s\n 
    time_pretransfer:  %{time_pretransfer}s\n
       time_redirect:  %{time_redirect}s\n     
  time_starttransfer:  %{time_starttransfer}s\n   
          time_total:  %{time_total}s\n'


while true
do
	#monitor HTTP status
	clear
	echo "======================"
	echo "Monitoring $1"
	echo "Expected status $2"
	echo "======================"
	if [[ $(curl -s -o /dev/null -I -w "%{http_code}" $1) != $expectedstatus ]] ; then
		printf ${red}${bg}"WARNING Unexpected STATUS: "${reset}
		curl -s -o /dev/null -I -w "%{http_code}" $1
		count429=$(($count429+1))
		printf "\r\n count: "$count429
		notify-send -u critical  "$count429 Unknown Status Events"
	else
		echo "All good"
	fi
	#curl -s -o /dev/null -I -w $time $1
	sleep 5
done
