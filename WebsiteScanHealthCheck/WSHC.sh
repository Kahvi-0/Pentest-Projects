#!/bin/bash

usage='WSHC.sh <URL> <Expected Status code> <HTTP Method for Requests> \n status code format: 200|301'

red=`tput setaf 1`
bg=`tput setab 7`
reset=`tput sgr 0`
count=0
expectedstatus=$2
time='  HTTP Status:	%{http_code}\n 
	time_namelookup:  %{time_namelookup}s\n
        time_connect:  %{time_connect}s\n   
     time_appconnect:  %{time_appconnect}s\n 
    time_pretransfer:  %{time_pretransfer}s\n
       time_redirect:  %{time_redirect}s\n     
  time_starttransfer:  %{time_starttransfer}s\n   
          time_total:  %{time_total}s\n'

if [[ $3 == "HEAD" ]] ; then
	method="-I"
else
	method="-X $3"
fi

while true
do
	#monitor HTTP status
	#clear
	echo "======================"
	echo "Monitoring $1"
	echo "Expected status $2"
	echo "Using HTTP Method $3"
	echo "======================"
	curl -s -o /dev/null $method -w "%{http_code}" $1 > status.txt
	if [[ $(cat ./status.txt) != $expectedstatus ]] ; then
		printf ${red}${bg}"WARNING Unexpected STATUS: "${reset}
		cat ./status.txt
		count=$(($count+1))
		printf "\r\n count: "$count
		notify-send -u normal -t 5000 "$count Unexpected Status Events"
	else
		echo "All good"
	fi
	#curl -s -o /dev/null -I -w $time $1
	sleep 5
done
